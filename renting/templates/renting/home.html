<!-- templates/renting/home.html -->
{% extends 'renting/base.html' %}
{% load static %}

{% block content %}
<!-- Search & Filter Section -->
<section class="mb-5 p-4 bg-white rounded shadow-sm border">
    <div class="row g-3 align-items-end">
        <!-- 기본 검색 -->
        <div class="col-md-4">
            <label class="form-label fw-bold small">Keyword Search</label>
            <input type="text" id="search-input" class="form-control" placeholder="Brand or model...">
        </div>
        <!-- 날짜 필터 (가용성) -->
        <div class="col-md-3">
            <label class="form-label fw-bold small">Pick-up Date</label>
            <input type="date" id="available-from" class="form-control">
        </div>
        <div class="col-md-3">
            <label class="form-label fw-bold small">Return Date</label>
            <input type="date" id="available-to" class="form-control">
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary w-100 py-2 fw-bold" onclick="loadVehicles(true)">Search</button>
        </div>
    </div>

    <!-- 상세 필터 토글 버튼 -->
    <div class="mt-3">
        <button class="btn btn-link btn-sm text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#advancedFilters">
            ⚙️ Advanced Filters & Sorting
        </button>
    </div>

    <!-- 상세 필터 섹션 -->
    <div class="collapse mt-3" id="advancedFilters">
        <div class="row g-3 pt-3 border-top">
            <div class="col-md-3">
                <label class="form-label small">Vehicle Type</label>
                <select class="form-select form-select-sm" id="filter-type">
                    <option value="">All Types</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small">Transmission</label>
                <select class="form-select form-select-sm" id="filter-trans">
                    <option value="">All</option>
                    <option value="Automatic">Automatic</option>
                    <option value="Manual">Manual</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label small">Seats</label>
                <select class="form-select form-select-sm" id="filter-seats">
                    <option value="">Any</option>
                    <option value="2">2 Seats</option>
                    <option value="4">4 Seats</option>
                    <option value="5">5 Seats</option>
                    <option value="7">7+ Seats</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label small">Sort By</label>
                <select class="form-select form-select-sm" id="sort-order">
                    <option value="">Default</option>
                    <option value="car_model__daily_price">Price: Low to High</option>
                    <option value="-car_model__daily_price">Price: High to Low</option>
                </select>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-outline-secondary btn-sm w-100" onclick="clearAllFilters()">Clear All</button>
            </div>
        </div>
    </div>
</section>

<!-- Vehicle List Area -->
<div class="vehicle-grid" id="vehicle-list"></div>

<!-- ⚠️ 하이브리드 컨트롤 영역 -->
<div id="pagination-controls" class="text-center mt-5 mb-5">
    <!-- 로딩 스피너 (데이터 로딩 중일 때만 표시) -->
    <div id="loading-spinner" class="spinner-border text-primary d-none" role="status"></div>
    
    <!-- 더보기 버튼 (무한 스크롤이 실패하거나 명시적으로 누르고 싶을 때) -->
    <button id="load-more-btn" class="btn btn-outline-dark px-5 py-2 d-none" onclick="loadVehicles()">
        Load More Vehicles
    </button>
    
    <!-- 마지막 메시지 -->
    <p id="no-more-msg" class="text-muted d-none">No more vehicles to display.</p>
</div>

<!-- 바닥 감지용 센서 (Observer가 관찰할 타겟) -->
<div id="scroll-sentinel" style="height: 10px;"></div>

<script src="{% static 'renting/js/home.js' %}"></script>
{% endblock %}