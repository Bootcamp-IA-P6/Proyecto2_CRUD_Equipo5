{% extends 'renting/base.html' %}

{% block content %}
<div class="card shadow-sm p-4">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Users</h2>
    </div>

    <!-- Users Table -->
    <table class="table table-striped">
        <!-- Table Headers -->
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
            </tr>
        </thead>
        <!-- Table Body - Populated by JavaScript -->
        <tbody id="user-list-body">
            <!-- JS populates this content -->
        </tbody>
    </table>
</div>

<!-- Inline JavaScript for User List Loading -->
<script>
    /**
     * Load users from API and populate table
     */
    async function loadUsers() {
        const response = await fetchWithAuth('/api/users/');
        if (!response) return;

        const data = await response.json();
        console.log(data);

        // Handle pagination response
        const items = Array.isArray(data) ? data : (data.results || []);

        const tbody = document.getElementById('user-list-body');

        if (items.length === 0) {
            tbody.innerHTML =
                '<tr><td colspan="3" class="text-center">No users found.</td></tr>';
            return;
        }

        tbody.innerHTML = items.map(u => `
            <tr>
                <td>${u.id}</td>
                <td>${u.first_name} ${u.last_name}</td>
                <td>${u.email}</td>
            </tr>
        `).join('');
    }

    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', loadUsers);
</script>
{% endblock %}
