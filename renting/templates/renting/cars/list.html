{% extends 'renting/base.html' %}
{% block content %}
<div class="card shadow-sm p-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Available Vehicles</h2>
    </div>
    <table class="table table-striped align-middle">
        <thead class="table-dark">
            <tr>
                <th>Brand</th>
                <th>Model</th>
                <th>License Plate</th>
                <th>Color</th>
                <th>Mileage</th>
            </tr>
        </thead>
        <tbody id="car-list-body">
            <tr><td colspan="5" class="text-center text-muted">Loading cars...</td></tr>
        </tbody>
    </table>
</div>

<script>
    async function loadCars() {
        const response = await fetchWithAuth('/api/cars/'); 
        if (!response) return;

        const data = await response.json();
        console.log("Car Data:", data);
        
        // 데이터가 배열이면 그대로 쓰고, 객체면 results 사용
        const items = Array.isArray(data) ? data : (data.results || []);
        
        const tbody = document.getElementById('car-list-body');
        
        if (items.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center">No vehicles found.</td></tr>';
            return;
        }

        tbody.innerHTML = items.map(c => `
            <tr>
                <td><strong>${c.brand_name || '-'}</strong></td>
                <td>${c.car_model_name}</td>
                <td><span class="badge bg-secondary text-uppercase">${c.license_plate}</span></td>
                <td>${c.color_name || '-'}</td>
                <td>${c.mileage ? c.mileage.toLocaleString() + ' km' : '-'}</td>
            </tr>
        `).join('');
    }

    document.addEventListener('DOMContentLoaded', loadCars);
</script>
{% endblock %}

<!-- temp change to trigger git -->